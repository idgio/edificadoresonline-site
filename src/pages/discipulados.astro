---
import BaseLayout from "@/layouts/BaseLayout.astro";
import entries from "@/data/discipulados.json";

type Entry = (typeof entries)[number];

const sortedEntries = [...entries].sort((a, b) => {
  if (a.year !== b.year) return a.year - b.year;
  return a.monthIndex - b.monthIndex;
});

const featuredEntry = sortedEntries[sortedEntries.length - 1];

const entryPath = (entry: Entry) => `/discipulados/${entry.year}/${entry.slug}`;
const entryTitle = (entry: Entry) =>
  entry.subtitle ? `${entry.title}: ${entry.subtitle}` : entry.title;
const featuredMonthLabel = featuredEntry.month.toUpperCase();
---

<BaseLayout title="Discipulados - Edificadores Online" headerClass="mb-12">
  <!-- Hero Section -->
  <section class="mb-16">
    <div class="grid gap-8 lg:grid-cols-[1fr_400px] items-center">
      <!-- Left - Main Image -->
      <div
        class="relative overflow-hidden rounded-3xl h-80 bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center h-200"
        style={`background-image: url('${featuredEntry.coverImage}'); background-size: cover; background-position: center;`}
      >
      </div>

      <!-- Right - Content -->
      <div class="space-y-6">
        <div>
          <p class="text-sm font-semibold text-[#666] mb-2">
            {featuredMonthLabel}
          </p>
          <h2
            class="text-3xl font-bold text-[#1c1c1c] mb-4"
            style="font-family: 'Playfair Display', serif;"
          >
            Discipulados
          </h2>
          <h3 class="text-xl font-semibold text-[#2d2d2d] mb-4">
            {entryTitle(featuredEntry)}
          </h3>
          <p class="text-sm text-[#4a4a4a] leading-relaxed">
            {featuredEntry.heroBlurb ?? featuredEntry.summary}
          </p>
        </div>
        <a
          href={entryPath(featuredEntry)}
          class="flex items-center gap-2 rounded-full bg-[#1c1c1c] px-6 py-3 text-sm font-semibold text-[#f7f1e7] transition hover:bg-[#0f0f0f] max-w-32"
        >
          Iniciar
          <span
            class="grid h-5 w-5 place-items-center rounded-full border border-[#f7f1e7]"
            >→</span
          >
        </a>
      </div>
    </div>
  </section>

  <!-- Monthly Sections -->
  <section class="space-y-12">
    <div>
      <h2
        class="text-3xl font-bold text-[#1c1c1c] mb-8"
        style="font-family: 'Playfair Display', serif;"
      >
        Discipulado de cada mes.
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {sortedEntries.map((entry) => (
          <div class="space-y-4">
            <a href={entryPath(entry)} class="block">
              <div
                class="relative overflow-hidden rounded-2xl h-48 bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center hover:scale-105 transition-transform cursor-pointer h-40"
                style={`background-image: url('${entry.coverImage}'); background-size: cover; background-position: center;`}
              >
              </div>
              <div>
                <p class="text-sm font-semibold text-[#666] mb-1">
                  {entry.month}
                </p>
                <h4 class="text-sm font-semibold text-[#1c1c1c] mb-2">
                  {entryTitle(entry)}
                </h4>
                <span
                  class="text-xs text-[#666] hover:text-[#1c1c1c] underline"
                  >Ver más...</span
                >
              </div>
            </a>
          </div>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>
